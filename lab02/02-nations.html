<!DOCTYPE html>
<head>
	<script src="https://d3js.org/d3.v4.min.js"></script>

	<style>
    	body { 
    		margin: 0;
    		position: fixed;
    		top: 0;
    		right: 0;
    		bottom: 0;
    		left: 0;
		}

		.title {
			font-family: "Georgia";
			font-size: 32px;
			fill: #000;
		}

		.axis {
			font-family: "Arial";
			font-size: 11px;
			fill: #808080;
		}

		.circle {
			fill: pink;
			fill-opacity: 0.50;
			stroke: #c0c0c0;
		}
	</style>
</head>
<body>
	<script>
		/*	Input: nations.json
			Output: 	x-axis = income
						y-axis = lifeExpectancy
						radius = population
						color  = region

			Bonus: use the raw data from class 3 and create the final dataset yourself. Add axes and labels.
			For extra practice: visualize the barley yield data. */

		var getAttrByYear = function(input, output, year, attr) {
			input[attr].forEach(function(d) { 
				if (d[0] === year) { 
					return output[attr] = d[1];
				}
			});
		};

		var filterByYear = function(input, year) {
			var result = [];

			input.forEach(function(i) {
				var country = {
					year: null,
					country: null,
					region: null,
					income: null,
					lifeExpectancy: null,
					population: null
				}

				getIncome = getAttrByYear(i, country, year, "income");
				getLifeExpectancy = getAttrByYear(i, country, year, "lifeExpectancy");
				getPopulation = getAttrByYear(i, country, year, "population");
				country.country = i.name;
				country.region = i.region;
				country.year = year;
				result.push(country);
			});
			return result;
		};

		var getMaxXY = function(input, attr) {
			var result = 0;
			input.forEach(function(d) {
				d[attr].forEach(function(i) {
					if (i[1] > val) {
						val = i[1];
					}
				});
			});
			return result;
		};
		
		d3.json("nations.json", function(error, data) {
			if (error) return error;
			console.log(data);		// original data

			// data
			newData = filterByYear(data, 1989);
			console.log(newData);	// filtered data

			// ------------------------------------------------------------

			// vars
			var margin = { top: 20, right: 20, bottom: 20, left: 20 };
			var width = 960 - margin.left - margin.right;
			var height = 500 - margin.top - margin.bottom;

			// min-max
			var xExtent = d3.extent(newData, function(d) { return d.income });
			var yExtent = d3.extent(newData, function(d) { return d.lifeExpectancy });
			var rExtent = d3.extent(newData, function(d) { return d.population });

			// scales
			var xScale = d3.scaleLog()
				.domain(xExtent)
				.range([0, width + margin.left]);
			var yScale = d3.scaleLinear()
				.domain(yExtent)
				.range([height + margin.bottom, 0]);
			var rScale = d3.scaleLinear()
				.domain(rExtent)
				.range([0, 100]);

			// axes
			var xAxis = d3.axisBottom()
				.scale(xScale);
			var yAxis = d3.axisLeft()
				.scale(yScale);

			// svg
			var svg = d3.select("body")
				.append("svg")
				.attr("width", width + margin.left + margin.right)
				.attr("height", height + margin.top + margin.bottom);

			// circles
			var dataPts = svg.selectAll("circle")
				.data(newData)
				.enter()
				.append("circle")
				.attr("class", "circle")
				.attr("r", function(d) { return rScale(d.population) })
				.attr("cx", function(d) { return xScale(d.income) })
				.attr("cy", function(d) { return yScale(d.lifeExpectancy) })
				.attr("id", function(d) { return d.country });
		});
	</script>
</body>
</html>