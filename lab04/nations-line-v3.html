<!DOCTYPE html>
<head>
	<title>Exoplanet Data Explorer</title>
	<script src="https://d3js.org/d3.v4.min.js"></script>
	<script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.2.1.js"></script>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

	<style>
		.circle {
			fill: SteelBlue;
			fill-opacity: 0.5;
		}

		.circle:hover {
			fill: #808080;
			fill-opacity: 0.75;
			stroke: White;
		}

		.title {
			font-size: 20px;
		}

		div.tooltip {   
			position: absolute;
			text-align: center;
			width: 160px; 
			height: 48px;
			padding: 2px;
			font: 12px sans-serif;  
			background: #f0f0f0;
			border: 0px;
			border-radius: 2px;
			pointer-events: none;
			color: #000;
		}

		.domain {
			stroke: #c0c0c0;
		}

		.tick > line {
			stroke: #c0c0c0;
		}
	</style>
</head>
<body>
	<div class="container" style="width: 990px;">
		<div id="menu" class="row">
			<div class="col-md-4 col-xs-4">
				<p>Nation 1</p>
				<select id="menu-1"></select>
			</div>
			<div class="col-md-4 col-xs-4">
				<p>Nation 2</p>
				<select id="menu-2"></select>
			</div>
			<div class="col-md-4 col-xs-4">
			<form id="series">
				<input class="series" type="radio" name="series" value="income" checked /> Income<br/>
				<input class="series" type="radio" name="series" value="lifeExpectancy" /> Life Expectancy<br/>
				<input class="series" type="radio" name="series" value="population" /> Population<br/>
			</form>
			</div>
		</div>
		<div class="row">
			<div class="col-md-12 col-xs-12 graph"></div>
		</div>
	</div>

	<script>
		// global variables ------------------------------------

		var margin = { top: 60, right: 50, bottom: 20, left: 50 };
		var width = 960 - margin.left - margin.right;
		var height = 500 - margin.top - margin.bottom;

		// =====================================================

		// populates dropdown menus with numeric values from numVals list
		function setMenu(data, menuID, defaultVal) {
			var dropdown = d3.select(menuID);
			dropdown.selectAll("option")
				.data(data)
				.enter()
				.append("option")
				.attr("value", function(d) { return d; })
				.attr("selected", function(d) { 
					if (d == defaultVal) { 
						return "selected";
					}
				})
				.text(function(d) { return d; });
		}

		// update selection
		// function update() {
		// };

		// setters ---------------------------------------------

		function setDomain(data, data1, data2) {
			return {
				x: [1800, 2009],
				y: d3.extent(data, function(d) { return d[yVal]; })
			}
		}

		function setRange() {
			return {
				x: [0, width],
				y: [height, 0]
			}
		}

		function setScale(domain, range) {
			return {
				x: d3.scaleLinear()
					.domain(domain.x)
					.range(range.x),
				y: d3.scaleLinear()
					.domain(domain.y)
					.range(range.y)
			}
		}

		function setAxes(scale) {
			return {
				x: d3.axisBottom().scale(scale.x),
				y: d3.axisLeft().scale(scale.y)
			}
		}

		// getters ---------------------------------------------

		function getNationData(data, nation, series) {
			var result = data.find(function(d) {
				if (d.name === nation) {
					return d;
				}
			})
			return result[series];
		}

		// append axes, title, svg -----------------------------

		function appendX(svg, axis) {
			var drawnX = svg.append("g")
				.call(axis.x)
				.attr("transform", "translate(0, " + height + ")");
			return drawnX;
		}

		function appendY(svg, axis) {
			drawnY = svg.append("g")
				.call(axis.y);
			return drawnY;
		}

		function appendTitle(svg, xVal, yVal) {
			var title = svg.append("text")
				.text(xVal + " vs. " + yVal)
				.attr("class", "title")
				.attr("transform", "translate(" + -margin.left + ", " + -(margin.top * 0.5) + ")")
				.attr("text-anchor", "start");
			return title;
		}

		function appendSVG() {
			var svg = d3.select(".graph")
				.append("svg")
				.attr("class", "exo-graph")
				.attr("width", width + margin.left + margin.right)
				.attr("height", height + margin.top + margin.bottom)
				.append("g")
				.attr("transform", "translate(" + margin.left + ", " + margin.top + ")");
			return svg;
		}

		// unorganized -----------------------------------------

		function update(data) {
			var nation1 = d3.select("#menu-1").property("value");
			var nation2 = d3.select("#menu-2").property("value");
			var series = d3.selectAll(".series:checked").property("value");
			var nation1data = getNationData(data, nation1, series);
			var nation2data = getNationData(data, nation2, series);
			console.log(nation1, nation2, series, nation1data, nation2data);

			d3.select("#menu-1").on("change", function(d) {
				nation1 = d3.select("#menu-1").property("value");
				nation1data = getNationData(data, nation1, series);
			})

			d3.select("#menu-2").on("change", function(d) {
				nation2 = d3.select("#menu-2").property("value");
				nation2data = getNationData(data, nation2, series);
			})

			d3.select("#series").on("change", function(d) {
				series = d3.selectAll(".series:checked").property("value");
				nation1data = getNationData(data, nation1, series);
				nation2data = getNationData(data, nation2, series);
			})
		}

		// main ------------------------------------------------

		d3.json("nations.json", function(error, data) {
			if (error) return error;
			console.log(data);

			var nations = data.map(function(d) { return d.name; });

			// set initial dropdown menu values
			setMenu(nations, "#menu-1", "Brunei");
			setMenu(nations, "#menu-2", "Qatar");

			// var domain = setDomain(data, xVal, yVal);
			// var range = setRange();
			// var scale = setScale(domain, range);
			// var axis = setAxis(scale);
			// var svg = appendSVG(svg);
			// var axisX = appendX(svg, axis);
			// var axisY = appendY(svg, axis);
			// var title = appendTitle(svg, xVal, yVal);

			update(data);
			
		})

		function callback(error, csv_data) {
			if (error) throw error;

			var data = csv_data;
			console.log(data);

			var nation1 = d3.select("#menu1")
				.property("value");
			var nation2 = d3.select("#menu2")
				.property("value");

			updateSVG(svg, data, xVal, yVal, title, axisX, axisY);

			d3.select("#menu-1").on("change", function(d) {
				nation2 = d3.select("#y-menu")
					.property("value");

				var nation2Data = d3.nest()
					.key(function(d) { return d.name == nation2 })
					.object(data);
				var nation2Series = nation2Data["true"][0].income;
				console.log(nation2);

				gNation2.datum(nation2Series)
					.attr("d", line);
			})
		};
	</script>
</body>
</html>